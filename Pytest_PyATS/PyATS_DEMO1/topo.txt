                 ┌──────────┐
                 │ Spine1   │
                 │ (BGP RR) │
                 └──────────┘
                   ↑    ↑
        ┌──────────┼────┼──────────┐
        │          │    │          │
   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐
   │ Leaf1  │ │ Leaf2  │ │ Leaf3  │ │ Leaf4  │
   │ VTEP   │ │ VTEP   │ │ VTEP   │ │ VTEP   │
   └────────┘ └────────┘ └────────┘ └────────┘
        │          │    │          │
        └──────────┼────┼──────────┘
                   ↓    ↓
                 ┌──────────┐
                 │ Spine2   │
                 │ (BGP RR) │
                 └──────────┘

Leaf1 — Baseline / Healthy Node
| Leg       | OSPF | BGP         | EVPN        | Interpretation |
| --------- | ---- | ----------- | ----------- | -------------- |
| To Spine1 | FULL | Established | Established | Healthy        |
| To Spine2 | FULL | Established | Established | Healthy        |

Leaf2 — Underlay MTU Issue (Single-Leg Risk / False Green)
| Leg       | OSPF                       | BGP         | EVPN        | Interpretation    |
| --------- | -------------------------- | ----------- | ----------- | ----------------- |
| To Spine1 | **EXSTART** (MTU mismatch) | Established | Established | Underlay impaired |
| To Spine2 | FULL                       | Established | Established | Healthy           |

Leaf3 — Overlay Session Failure (BGP/EVPN Single-Leg)
| Leg       | OSPF | BGP         | EVPN        | Interpretation  |
| --------- | ---- | ----------- | ----------- | --------------- |
| To Spine1 | FULL | Established | Established | Healthy         |
| To Spine2 | FULL | **Idle**    | **Idle**    | Overlay failure |

Leaf4 — Single Uplink Shutdown (Classic Single-Leg Failure)
| Leg       | OSPF                | BGP         | EVPN        | Interpretation |
| --------- | ------------------- | ----------- | ----------- | -------------- |
| To Spine1 | **Down (shutdown)** | **Idle**    | **Idle**    | Uplink failure |
| To Spine2 | FULL                | Established | Established | Healthy        |


# Key Points – Pytest / pyATS Network QA

## 1. Project Structure (Industry Standard)
- tests/ → only test code (pytest)
- src/ → business logic being tested
- src/utils/ → reusable utilities (YAML loader, log parser, helpers)
This structure is CI-friendly and aligned with pytest / pyATS best practices.

## 2. Regex Usage in Network Log Parsing
- re.search():
  Used to locate a single structural block (e.g. one command output).
- re.findall():
  Used to extract multiple repeated entries inside that block (e.g. neighbors).

## 3. Regex Flags
- re.I (IGNORECASE): case-insensitive matching
- re.S (DOTALL): '.' matches newline, used for multi-line command output
- re.M (MULTILINE): '^' and '$' apply per line (useful for neighbors/interfaces)

## 4. BGP vs Address-Family (EVPN)
- Underlay BGP (IPv4 unicast) can be Established
- EVPN (L2VPN EVPN AFI/SAFI) can still be Idle or Down
- Therefore:
  - Underlay health ≠ EVPN health
  - EVPN must be validated per neighbor, not by neighbor count

## 5. EVPN Parsing Principle
- EVPN does NOT require route count to judge health
- Only State (Idle / Established) matters
- Prefix count is secondary and context-dependent


INTERFACE_PROBLEM
DATA_PLANE_ERROR
CONTROL_PLANE_NEIGHBOR_DOWN
CONTROL_PLANE_PROTOCOL_DOWN
UNKNOWN
